<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Guided solution (page 1) :: Red Hat OpenStack Networking: Break-fix Practice - Diagnosing Destination Host Unreachable and No Route to Host Errors</title>
    <link rel="prev" href="index.html">
    <link rel="next" href="section2.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">Red Hat OpenStack Networking: Break-fix Practice - Diagnosing Destination Host Unreachable and No Route to Host Errors</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/REPLACEREPONAME/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="rhosp-bfx-019" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Red Hat OpenStack Networking: Break-fix Practice - Diagnosing Destination Host Unreachable and No Route to Host Errors</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Red Hat OpenStack Platform: Break-fix Practice - Diagnosing Destination Host Unreachable and No Route to Host Errors</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../LABENV/index.html">Lab Environment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../chapter1/index.html">Whatâ€™s in this break-fix?</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter1/section1.html">Break-fix activity</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter1/section2.html">Check your work</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../chapter1/section3.html">Break-fix Scenario</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Guided solution</a>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="section1.html">Guided solution (page 1)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="section2.html">Guided solution (page 2)</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../chapter3/summary.html">Summary</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Red Hat OpenStack Networking: Break-fix Practice - Diagnosing Destination Host Unreachable and No Route to Host Errors</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Red Hat OpenStack Networking: Break-fix Practice - Diagnosing Destination Host Unreachable and No Route to Host Errors</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Red Hat OpenStack Networking: Break-fix Practice - Diagnosing Destination Host Unreachable and No Route to Host Errors</a></li>
    <li><a href="index.html">Guided solution</a></li>
    <li><a href="section1.html">Guided solution (page 1)</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Guided solution (page 1)</h1>
<div class="sect1">
<h2 id="_objectives"><a class="anchor" href="#_objectives"></a>Objectives</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Investigate the instance connectivity issue in Red Hat OpenStack Platform.</p>
</li>
<li>
<p>Solve the instance connectivity in the hands-on lab environment.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_outcomes"><a class="anchor" href="#_outcomes"></a>Outcomes</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Investigate why ssh to instance is not working.</p>
</li>
<li>
<p>Fix the ssh to instance failing issue.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_instructions"><a class="anchor" href="#_instructions"></a>Instructions</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Break the environment if you have not done it and then step through the fix.</p>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>[student@workstation ~]$ ssh stack@director
[stack@director ~]$ source overcloudrc
(overcloud) [stack@director ~]$ lab start bfx019
Running start action against scenario bfx019
Run the following command:
ssh -i /home/stack/osp_training/.scenariobfx019/scenario-bfx019-key.pem cirros@172.25.250.203</p>
</div>
</blockquote>
</div>
</li>
<li>
<p>Run the ssh command from the previous lab command output and notice the Connection timed out error. Also run the ping command against instance IP.</p>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>(overcloud) [stack@director ~]$ ssh -i /home/stack/osp_training/.scenariobfx019/scenario-bfx019-key.pem cirros@172.25.250.203
*
ssh: connect to host 172.25.250.203 port 22: Connection timed out</p>
</div>
<div class="paragraph">
<p>(overcloud) [stack@director ~]$ *ping 172.25.250.203 -c 1
PING 172.25.250.203 (172.25.250.203) 56(84) bytes of data.</p>
</div>
<div class="paragraph">
<p>--- 172.25.250.203 ping statistics ---
1 packets transmitted, 0 received, 100% packet loss, time 0ms</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>You observe that both ping and ssh attempts failed which indicates lack of connectivity.</p>
</div>
</li>
<li>
<p>Access the overcloud environment and determine the specific compute node where the instance is currently running.</p>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>(overcloud) [stack@director ~]$ openstack server list --long -c Name -c Status -c Host
-----------------------------------------------------------------
| Name               | Status | Host                                |
-----------------------------------------------------------------
| scenario-bfx019-vm | ACTIVE | overcloud-novacompute-1.localdomain |
-----------------------------------------------------------------</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Observe that it is overcloud-novacompute-1 in the above output, it my differ in your case.</p>
</div>
</li>
<li>
<p>Make sure you have access to compute node from other terminal before proceeding further.</p>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>(overcloud) [stack@director ~]$ ssh tripleo-admin@overcloud-compute1
Register this system with Red Hat Insights: insights-client --register
Create an account or view all your systems at <a href="https://red.ht/insights-dashboard" class="bare">https://red.ht/insights-dashboard</a>
Last login: Sat Mar 16 09:49:27 2024 from 172.25.249.11
[tripleo-admin@overcloud-novacompute-1 ~]$</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Note the slight change in the compute node&#8217;s hostname for ssh connectivity.</p>
</div>
</li>
<li>
<p>Check the route taken to reach the instance from the director VM.</p>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>(overcloud) [stack@director ~]$ ip route get 172.25.250.203
172.25.250.203 dev eth0 src 172.25.250.11 uid 1003</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>The above output shows that the route goes through eth0.</p>
</div>
</li>
<li>
<p>Confirm that the director VM and the instance&#8217;s floating IP are on the same Layer 2 (L2) domain, specifically on the 172.25.250.0 subnet.</p>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>(overcloud) [stack@director ~]$ ip addr show eth0
2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 52:54:00:04:fa:0b brd ff:ff:ff:ff:ff:ff
    altname enp0s3
    altname ens3
    inet 172.25.250.11/24 brd 172.25.250.255 scope global noprefixroute eth0
       valid_lft forever preferred_lft forever
    inet6 fe80::5054:ff:fe04:fa0b/64 scope link
       valid_lft forever preferred_lft forever</p>
</div>
</blockquote>
</div>
</li>
<li>
<p>Examine the ARP cache on the director VM.</p>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>(overcloud) [stack@director ~]$ ip neighbor | grep 172.25.250.203
172.25.250.203 dev eth0 lladdr fa:16:3e:60:74:ec STALE</p>
</div>
</blockquote>
</div>
<div class="ulist">
<ul>
<li>
<p>An entry with the floating IP is associated with a MAC address, indicating successful ARP negotiation.</p>
</li>
<li>
<p>This signifies functional communication via ARP, but ICMP communication remains problematic.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Let us proceed to check whether the packets are being correctly routed to the appropriate node. Run the below command on the compute node to check the interface associated with the bridge br-ex.</p>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>(overcloud) [stack@director ~]$ ssh tripleo-admin@overcloud-compute0
Register this system with Red Hat Insights: insights-client --register
Create an account or view all your systems at <a href="https://red.ht/insights-dashboard" class="bare">https://red.ht/insights-dashboard</a>
Last login: Mon Feb  5 10:54:20 2024 from 172.25.249.11
[tripleo-admin@overcloud-novacompute-0 ~]$ sudo -i
[root@overcloud-novacompute-0 ~]# ovs-vsctl show
1943688a-c727-41a4-b37e-21ae1365b65d
    Manager "ptcp:6640:127.0.0.1"
        is_connected: true
    Bridge br-ex
        fail_mode: standalone
        Port br-ex
            Interface br-ex
                type: internal
        Port patch-provnet-7b11bd78-649c-49b7-a08d-bd11c75bd41a-to-br-int
            Interface patch-provnet-7b11bd78-649c-49b7-a08d-bd11c75bd41a-to-br-int
                type: patch
                options: {peer=patch-br-int-to-provnet-7b11bd78-649c-49b7-a08d-bd11c75bd41a}
        Port ens4
            Interface ens4</p>
</div>
</blockquote>
</div>
</li>
<li>
<p>To verify incoming traffic, initiate a tcpdump on this interface on the compute node and try to ping the instance from another terminal from the director node.</p>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>[root@overcloud-novacompute-0 ~]# tcpdump -envvi ens4 icmp
dropped privs to tcpdump
tcpdump: listening on ens4, link-type EN10MB (Ethernet), snapshot length 262144 bytes
11:13:36.847633 52:54:00:04:fa:0b &gt; fa:16:3e:60:74:ec, ethertype IPv4 (0x0800), length 98: (tos 0x0, ttl 64, id 20399, offset 0, flags [DF], proto ICMP (1), length 84)
    172.25.250.11 &gt; 172.25.250.203: ICMP echo request, id 2, seq 1, length 64
11:13:37.867835 52:54:00:04:fa:0b &gt; fa:16:3e:60:74:ec, ethertype IPv4 (0x0800), length 98: (tos 0x0, ttl 64, id 20599, offset 0, flags [DF], proto ICMP (1), length 84)
    172.25.250.11 &gt; 172.25.250.203: ICMP echo request, id 2, seq 2, length 64
11:13:38.891757 52:54:00:04:fa:0b &gt; fa:16:3e:60:74:ec, ethertype IPv4 (0x0800), length 98: (tos 0x0, ttl 64, id 20848, offset 0, flags [DF], proto ICMP (1), length 84)
    172.25.250.11 &gt; 172.25.250.203: ICMP echo request, id 2, seq 3, length 64
11:13:39.915886 52:54:00:04:fa:0b &gt; fa:16:3e:60:74:ec, ethertype IPv4 (0x0800), length 98: (tos 0x0, ttl 64, id 21512, offset 0, flags [DF], proto ICMP (1), length 84)
    172.25.250.11 &gt; 172.25.250.203: ICMP echo request, id 2, seq 4, length 64</p>
</div>
</blockquote>
</div>
<div class="ulist">
<ul>
<li>
<p>You observe that ICMP echo requests arriving at the machine.</p>
</li>
<li>
<p>The presence of ICMP echo requests reaching the external NIC on the compute node indicates the proper functioning of the Distributed Virtual Router (DVR).</p>
</li>
<li>
<p>However, you observed that echo requests are not receiving the echo replies on the director VM.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="index.html">Guided solution</a></span>
  <span class="next"><a href="section2.html">Guided solution (page 2)</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
